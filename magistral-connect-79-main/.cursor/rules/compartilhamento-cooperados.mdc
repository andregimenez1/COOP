---
description: Regras de compartilhamento e acesso entre cooperados
alwaysApply: true
---

# Compartilhamento e Acesso entre Cooperados

## Regra Fundamental

**TUDO que pode ser armazenado no banco de dados DEVE estar no banco de dados.**

**TUDO que √© de acesso para cooperados DEVE ser compartilhado entre TODOS os cooperados.**

**A √öNICA exce√ß√£o s√£o recursos explicitamente declarados como "meus" (exclusivos do usu√°rio).**

## Recursos Compartilhados (Todos os Cooperados)

Estes recursos devem ser acess√≠veis por **TODOS** os cooperados, sem filtro por `userId`:

- ‚úÖ **Fornecedores** - Todos os fornecedores aprovados
- ‚úÖ **Subst√¢ncias** - Todas as subst√¢ncias cadastradas
- ‚úÖ **Solicita√ß√µes** - Admin v√™ todas, usu√°rios veem as suas pr√≥prias
- ‚úÖ **Ofertas do Marketplace** - Todas as ofertas ativas
- ‚úÖ **Cota√ß√µes** - Todas as cota√ß√µes
- ‚úÖ **Qualquer recurso p√∫blico/compartilhado**

## Recursos Exclusivos (Apenas do Usu√°rio)

Estes recursos s√£o exclusivos e devem ser filtrados por `userId`:

- üîí **Meus Laudos** - Laudos do pr√≥prio usu√°rio
- üîí **Meu Perfil** - Dados pessoais do pr√≥prio usu√°rio
- üîí **Minhas Notifica√ß√µes** - Notifica√ß√µes do pr√≥prio usu√°rio
- üîí **Meus Dados Banc√°rios** - Dados banc√°rios do pr√≥prio usu√°rio
- üîí **Minhas Contribui√ß√µes Financeiras** - Dados financeiros do pr√≥prio usu√°rio
- üîí **Qualquer recurso explicitamente marcado como "meu"**

## Implementa√ß√£o

### Backend - Endpoints Compartilhados

```typescript
// ‚úÖ CORRETO - Retornar todos os recursos
const suppliers = await prisma.supplier.findMany({
  orderBy: { createdAt: 'desc' },
});

// ‚ùå ERRADO - Filtrar por userId quando deveria ser compartilhado
const suppliers = await prisma.supplier.findMany({
  where: { userId }, // N√ÉO fazer isso para recursos compartilhados
});
```

### Backend - Endpoints Exclusivos

```typescript
// ‚úÖ CORRETO - Filtrar por userId para recursos exclusivos
const laudos = await prisma.rawMaterial.findMany({
  where: { userId }, // Correto para "meus laudos"
  orderBy: { createdAt: 'desc' },
});
```

## Checklist ao Criar/Modificar Endpoints

- [ ] Este recurso √© compartilhado ou exclusivo?
- [ ] Se compartilhado: remover filtro `where: { userId }`
- [ ] Se exclusivo: manter filtro `where: { userId }`
- [ ] Documentar no c√≥digo se √© compartilhado ou exclusivo
- [ ] Testar que todos os cooperados podem acessar recursos compartilhados

## Exemplos de Recursos

### Compartilhados
- Lista de fornecedores aprovados
- Lista de subst√¢ncias dispon√≠veis
- Ofertas do marketplace
- Cota√ß√µes p√∫blicas
- Not√≠cias e avisos

### Exclusivos
- Laudos do usu√°rio (`/laudos` - apenas os meus)
- Perfil do usu√°rio (`/perfil` - apenas o meu)
- Notifica√ß√µes do usu√°rio (apenas as minhas)
- Dados banc√°rios do usu√°rio (apenas os meus)
- Hist√≥rico financeiro do usu√°rio (apenas o meu)

## Prioridade

Esta regra tem **ALTA PRIORIDADE**. Sempre verifique se recursos compartilhados est√£o realmente acess√≠veis a todos os cooperados.
